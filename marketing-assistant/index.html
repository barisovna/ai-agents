<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI –ú–∞—Ä–∫–µ—Ç–∏–Ω–≥ –ê—Å—Å–∏—Å—Ç–µ–Ω—Ç Pro</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        :root {
            --primary: #667eea;
            --primary-dark: #5568d3;
            --secondary: #764ba2;
            --bg-main: #ffffff;
            --bg-secondary: #f8f9fa;
            --bg-tertiary: #e9ecef;
            --text-primary: #212529;
            --text-secondary: #6c757d;
            --border-color: #dee2e6;
            --shadow: rgba(0,0,0,0.1);
            --message-user: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --message-ai: #ffffff;
            --success: #10b981;
            --warning: #f59e0b;
            --error: #ef4444;
        }

        [data-theme="dark"] {
            --bg-main: #1a1a2e;
            --bg-secondary: #16213e;
            --bg-tertiary: #0f1419;
            --text-primary: #e4e4e7;
            --text-secondary: #a1a1aa;
            --border-color: #27272a;
            --shadow: rgba(0,0,0,0.3);
            --message-ai: #27272a;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 10px;
            color: var(--text-primary);
            transition: all 0.3s ease;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: var(--bg-main);
            border-radius: 24px;
            box-shadow: 0 20px 80px var(--shadow);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            height: calc(100vh - 20px);
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .header-right {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .icon-btn {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            position: relative;
        }

        .icon-btn:hover {
            background: rgba(255,255,255,0.3);
            transform: scale(1.1);
        }

        .theme-toggle {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
        }

        .main-content {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        .sidebar {
            width: 380px;
            background: var(--bg-secondary);
            border-right: 1px solid var(--border-color);
            overflow-y: auto;
            padding: 20px;
            transition: all 0.3s;
        }

        .sidebar::-webkit-scrollbar {
            width: 6px;
        }

        .sidebar::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 3px;
        }

        .chat-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            min-width: 0;
        }

        .collapsible-section {
            background: var(--bg-main);
            border-radius: 12px;
            margin-bottom: 15px;
            border: 1px solid var(--border-color);
            overflow: hidden;
            transition: all 0.3s;
        }

        .collapsible-section:hover {
            box-shadow: 0 4px 12px var(--shadow);
        }

        .section-header {
            padding: 15px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--bg-secondary);
            user-select: none;
        }

        .section-header h3 {
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-header i {
            transition: transform 0.3s;
        }

        .section-header.active i {
            transform: rotate(180deg);
        }

        .section-content {
            padding: 0;
            max-height: 0;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .section-content.active {
            padding: 15px;
            max-height: 800px;
        }

        .expert-card {
            background: var(--bg-secondary);
            border: 2px solid var(--border-color);
            border-radius: 12px;
            padding: 12px;
            cursor: pointer;
            margin-bottom: 10px;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .expert-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: var(--primary);
            transform: scaleY(0);
            transition: transform 0.3s;
        }

        .expert-card:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 12px var(--shadow);
        }

        .expert-card.active {
            border-color: var(--primary);
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
        }

        .expert-card.active::before {
            transform: scaleY(1);
        }

        .expert-card h4 {
            font-size: 15px;
            margin-bottom: 5px;
            color: var(--text-primary);
        }

        .expert-card p {
            font-size: 13px;
            color: var(--text-secondary);
        }

        .platform-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
        }

        .platform-btn {
            padding: 10px;
            background: var(--bg-secondary);
            border: 2px solid var(--border-color);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
            justify-content: center;
            font-size: 14px;
            color: var(--text-primary);
        }

        .platform-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px var(--shadow);
        }

        .platform-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: transparent;
        }

        .input-group {
            margin-bottom: 12px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            font-size: 14px;
            color: var(--text-primary);
        }

        .input-group textarea,
        .input-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--border-color);
            border-radius: 10px;
            resize: vertical;
            min-height: 80px;
            font-family: inherit;
            background: var(--bg-main);
            color: var(--text-primary);
            transition: all 0.3s;
        }

        .input-group textarea:focus,
        .input-group input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 14px 24px;
            border-radius: 12px;
            cursor: pointer;
            width: 100%;
            font-weight: 600;
            font-size: 15px;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .quick-actions {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
        }

        .quick-action-btn {
            padding: 10px;
            background: var(--bg-secondary);
            border: 2px solid var(--border-color);
            border-radius: 10px;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.3s;
            color: var(--text-primary);
        }

        .quick-action-btn:hover {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .chat-container {
            display: none;
            flex-direction: column;
            height: 100%;
        }

        .chat-container.active {
            display: flex;
        }

        .messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            background: var(--bg-secondary);
        }

        .messages::-webkit-scrollbar {
            width: 8px;
        }

        .messages::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 4px;
        }

        .message {
            margin-bottom: 20px;
            animation: messageSlide 0.3s ease;
            position: relative;
        }

        @keyframes messageSlide {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message-content {
            padding: 16px 20px;
            border-radius: 16px;
            position: relative;
            max-width: 85%;
        }

        .message.user .message-content {
            background: var(--message-user);
            color: white;
            margin-left: auto;
            border-bottom-right-radius: 4px;
        }

        .message.assistant .message-content {
            background: var(--message-ai);
            border: 1px solid var(--border-color);
            max-width: 95%;
            border-bottom-left-radius: 4px;
        }

        .message-actions {
            display: flex;
            gap: 8px;
            margin-top: 8px;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .message:hover .message-actions {
            opacity: 1;
        }

        .message-action-btn {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            padding: 6px 12px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 12px;
            color: var(--text-secondary);
            transition: all 0.3s;
        }

        .message-action-btn:hover {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .typing-indicator {
            display: none;
            align-items: center;
            gap: 8px;
            padding: 16px;
            background: var(--message-ai);
            border-radius: 16px;
            max-width: 80px;
            border: 1px solid var(--border-color);
        }

        .typing-indicator.active {
            display: flex;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            background: var(--primary);
            border-radius: 50%;
            animation: typing 1.4s infinite;
        }

        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typing {
            0%, 60%, 100% {
                transform: translateY(0);
                opacity: 0.7;
            }
            30% {
                transform: translateY(-10px);
                opacity: 1;
            }
        }

        .input-area {
            padding: 20px;
            background: var(--bg-main);
            border-top: 1px solid var(--border-color);
        }

        .input-wrapper {
            display: flex;
            gap: 10px;
            align-items: flex-end;
        }

        .input-wrapper textarea {
            flex: 1;
            padding: 14px;
            border: 2px solid var(--border-color);
            border-radius: 12px;
            resize: none;
            max-height: 120px;
            font-family: inherit;
            background: var(--bg-secondary);
            color: var(--text-primary);
            transition: all 0.3s;
        }

        .input-wrapper textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .send-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 14px 24px;
            border-radius: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
            transition: all 0.3s;
        }

        .send-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .send-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .toast {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: var(--bg-main);
            color: var(--text-primary);
            padding: 16px 24px;
            border-radius: 12px;
            box-shadow: 0 8px 24px var(--shadow);
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.3s;
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 12px;
            border: 1px solid var(--border-color);
        }

        .toast.show {
            opacity: 1;
            transform: translateY(0);
        }

        .toast.success {
            border-left: 4px solid var(--success);
        }

        .toast.error {
            border-left: 4px solid var(--error);
        }

        .toast.warning {
            border-left: 4px solid var(--warning);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            backdrop-filter: blur(4px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--bg-main);
            border-radius: 20px;
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .modal-header {
            padding: 20px 24px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h2 {
            font-size: 20px;
            color: var(--text-primary);
        }

        .modal-body {
            padding: 24px;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--text-secondary);
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            transition: all 0.3s;
        }

        .close-modal:hover {
            background: var(--bg-secondary);
            color: var(--text-primary);
        }

        .budget-calc {
            display: grid;
            gap: 15px;
        }

        .budget-result {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
            padding: 20px;
            border-radius: 12px;
            margin-top: 15px;
            display: none;
        }

        .budget-result.active {
            display: block;
        }

        .budget-result h3 {
            margin-bottom: 15px;
            color: var(--primary);
        }

        .budget-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .template-grid {
            display: grid;
            gap: 12px;
        }

        .template-card {
            padding: 16px;
            background: var(--bg-secondary);
            border: 2px solid var(--border-color);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .template-card:hover {
            border-color: var(--primary);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px var(--shadow);
        }

        .template-card h4 {
            margin-bottom: 8px;
            color: var(--text-primary);
        }

        .template-card p {
            font-size: 13px;
            color: var(--text-secondary);
        }

        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            margin-right: 8px;
        }

        .badge.vk { background: #0077ff; color: white; }
        .badge.telegram { background: #0088cc; color: white; }
        .badge.dzen { background: #ff6600; color: white; }
        .badge.max { background: #9333ea; color: white; }
        .badge.yandex { background: #ffcc00; color: #000; }
        .badge.avito { background: #00aaff; color: white; }

        @media (max-width: 1024px) {
            .sidebar {
                width: 320px;
            }
        }

        @media (max-width: 768px) {
            .container {
                border-radius: 0;
                height: 100vh;
            }

            .main-content {
                flex-direction: column;
            }

            .sidebar {
                width: 100%;
                max-height: 40vh;
                border-right: none;
                border-bottom: 1px solid var(--border-color);
            }

            .header {
                padding: 15px 20px;
            }

            .header h1 {
                font-size: 18px;
            }
        }

        .message-content h1,
        .message-content h2,
        .message-content h3 {
            margin: 16px 0 8px 0;
        }

        .message-content ul,
        .message-content ol {
            margin: 8px 0;
            padding-left: 24px;
        }

        .message-content li {
            margin: 4px 0;
        }

        .message-content code {
            background: var(--bg-secondary);
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
        }

        .message-content pre {
            background: var(--bg-tertiary);
            padding: 12px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 12px 0;
        }

        .message-content pre code {
            background: none;
            padding: 0;
        }

        .message-content blockquote {
            border-left: 4px solid var(--primary);
            padding-left: 16px;
            margin: 12px 0;
            color: var(--text-secondary);
        }

        .message-content a {
            color: var(--primary);
            text-decoration: none;
        }

        .message-content a:hover {
            text-decoration: underline;
        }

        .message-content strong {
            font-weight: 600;
        }

        .session-item {
            padding: 12px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .session-item:hover {
            border-color: var(--primary);
            transform: translateX(5px);
        }

        .session-info {
            flex: 1;
        }

        .session-info h4 {
            font-size: 14px;
            margin-bottom: 4px;
            color: var(--text-primary);
        }

        .session-info p {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .delete-session {
            background: var(--error);
            color: white;
            border: none;
            width: 32px;
            height: 32px;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .delete-session:hover {
            transform: scale(1.1);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-left">
                <i class="fas fa-rocket" style="font-size: 24px;"></i>
                <h1>AI –ú–∞—Ä–∫–µ—Ç–∏–Ω–≥ –ê—Å—Å–∏—Å—Ç–µ–Ω—Ç Pro</h1>
            </div>
            <div class="header-right">
                <button class="icon-btn" onclick="openModal('historyModal')" title="–ò—Å—Ç–æ—Ä–∏—è —Å–µ—Å—Å–∏–π">
                    <i class="fas fa-history"></i>
                </button>
                <button class="icon-btn" onclick="openModal('budgetModal')" title="–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –±—é–¥–∂–µ—Ç–∞">
                    <i class="fas fa-calculator"></i>
                </button>
                <button class="icon-btn" onclick="openModal('templatesModal')" title="–®–∞–±–ª–æ–Ω—ã –∫–æ–Ω—Ç–µ–Ω—Ç–∞">
                    <i class="fas fa-file-alt"></i>
                </button>
                <button class="icon-btn" onclick="exportChat()" title="–≠–∫—Å–ø–æ—Ä—Ç —á–∞—Ç–∞">
                    <i class="fas fa-download"></i>
                </button>
                <button class="theme-toggle" onclick="toggleTheme()">
                    <i class="fas fa-moon" id="themeIcon"></i>
                    <span id="themeText">–¢–µ–º–Ω–∞—è</span>
                </button>
            </div>
        </div>

        <div class="main-content">
            <div class="sidebar">
                <div class="collapsible-section">
                    <div class="section-header active" onclick="toggleSection(this)">
                        <h3><i class="fas fa-user-tie"></i> –í—ã–±–µ—Ä–∏—Ç–µ —ç–∫—Å–ø–µ—Ä—Ç–∞</h3>
                        <i class="fas fa-chevron-down"></i>
                    </div>
                    <div class="section-content active">
                        <div class="expert-card active" data-expert="krivov">
                            <h4><i class="fas fa-crown" style="color: gold;"></i> –í–ª–∞–¥–∏–º–∏—Ä –ö—Ä–∏–≤–æ–≤</h4>
                            <p>–¢–æ–ø –º–∞—Ä–∫–µ—Ç–æ–ª–æ–≥ –†–æ—Å—Å–∏–∏ 2026</p>
                        </div>
                        <div class="expert-card" data-expert="sebrant">
                            <h4><i class="fas fa-chart-line" style="color: #ff3333;"></i> –ê–Ω–¥—Ä–µ–π –°–µ–±—Ä–∞–Ω—Ç</h4>
                            <p>–≠–∫—Å–ø–µ—Ä—Ç –Ø–Ω–¥–µ–∫—Å–∞</p>
                        </div>
                        <div class="expert-card" data-expert="zakharov">
                            <h4><i class="fas fa-search" style="color: #4caf50;"></i> –ú–∞–∫—Å–∏–º –ó–∞—Ö–∞—Ä–æ–≤</h4>
                            <p>SEO-–≥—É—Ä—É</p>
                        </div>
                        <div class="expert-card" data-expert="content">
                            <h4><i class="fas fa-pen-fancy" style="color: #ff9800;"></i> –ö–æ–Ω—Ç–µ–Ω—Ç-—Å—Ç—Ä–∞—Ç–µ–≥</h4>
                            <p>–≠–∫—Å–ø–µ—Ä—Ç –ø–æ —Å–æ–∑–¥–∞–Ω–∏—é –∫–æ–Ω—Ç–µ–Ω—Ç–∞</p>
                        </div>
                        <div class="expert-card" data-expert="targeting">
                            <h4><i class="fas fa-crosshairs" style="color: #e91e63;"></i> –¢–∞—Ä–≥–µ—Ç–æ–ª–æ–≥</h4>
                            <p>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–µ–∫–ª–∞–º–Ω—ã—Ö –∫–∞–±–∏–Ω–µ—Ç–æ–≤</p>
                        </div>
                    </div>
                </div>

                <div class="collapsible-section">
                    <div class="section-header active" onclick="toggleSection(this)">
                        <h3><i class="fas fa-share-alt"></i> –í—ã–±–µ—Ä–∏—Ç–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã</h3>
                        <i class="fas fa-chevron-down"></i>
                    </div>
                    <div class="section-content active">
                        <div class="platform-grid">
                            <button class="platform-btn" data-platform="vk">
                                <i class="fab fa-vk"></i> –í–ö–æ–Ω—Ç–∞–∫—Ç–µ
                            </button>
                            <button class="platform-btn" data-platform="vk-ads">
                                <i class="fas fa-bullhorn"></i> VK –†–µ–∫–ª–∞–º–∞
                            </button>
                            <button class="platform-btn" data-platform="telegram">
                                <i class="fab fa-telegram"></i> Telegram
                            </button>
                            <button class="platform-btn" data-platform="dzen">
                                <i class="fas fa-newspaper"></i> –î–∑–µ–Ω
                            </button>
                            <button class="platform-btn" data-platform="max">
                                <i class="fas fa-ad"></i> MAX
                            </button>
                            <button class="platform-btn" data-platform="yandex">
                                <i class="fas fa-bullseye"></i> –Ø–Ω–¥–µ–∫—Å –î–∏—Ä–µ–∫—Ç
                            </button>
                            <button class="platform-btn" data-platform="metrika">
                                <i class="fas fa-chart-bar"></i> –Ø–Ω–¥–µ–∫—Å –ú–µ—Ç—Ä–∏–∫–∞
                            </button>
                            <button class="platform-btn" data-platform="avito">
                                <i class="fas fa-store"></i> –ê–≤–∏—Ç–æ
                            </button>
                            <button class="platform-btn" data-platform="website">
                                <i class="fas fa-globe"></i> –°–∞–π—Ç—ã
                            </button>
                        </div>
                    </div>
                </div>

                <div class="collapsible-section">
                    <div class="section-header" onclick="toggleSection(this)">
                        <h3><i class="fas fa-brain"></i> –†–µ–∂–∏–º AI</h3>
                        <i class="fas fa-chevron-down"></i>
                    </div>
                    <div class="section-content">
                        <div class="input-group">
                            <label><i class="fas fa-robot"></i> –í—ã–±–µ—Ä–∏—Ç–µ –º–æ–¥–µ–ª—å</label>
                            <select id="aiModel" style="width: 100%; padding: 10px; border: 2px solid var(--border-color); border-radius: 8px; background: var(--bg-main); color: var(--text-primary);">
                                <option value="deepseek-chat">üí¨ Chat (–ë—ã—Å—Ç—Ä–æ, 8K —Ç–æ–∫–µ–Ω–æ–≤)</option>
                                <option value="deepseek-reasoner">üß† Reasoner (–ì–ª—É–±–æ–∫–∏–π –∞–Ω–∞–ª–∏–∑, 64K)</option>
                            </select>
                            <p style="font-size: 12px; color: var(--text-secondary); margin-top: 8px;">
                                Chat - –æ–±—ã—á–Ω—ã–π —Ä–µ–∂–∏–º, –±—ã—Å—Ç—Ä—ã–µ –æ—Ç–≤–µ—Ç—ã.<br>
                                Reasoner - —Ä–µ–∂–∏–º —Ä–∞–∑–º—ã—à–ª–µ–Ω–∏—è –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö –∑–∞–¥–∞—á.
                            </p>
                        </div>
                    </div>
                </div>

                <div class="collapsible-section">
                    <div class="section-header active" onclick="toggleSection(this)">
                        <h3><i class="fas fa-project-diagram"></i> –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞</h3>
                        <i class="fas fa-chevron-down"></i>
                    </div>
                    <div class="section-content active">
                        <div class="input-group">
                            <label><i class="fas fa-info-circle"></i> –û–ø–∏—à–∏—Ç–µ –≤–∞—à –ø—Ä–æ–µ–∫—Ç</label>
                            <textarea id="projectDesc" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ò–Ω—Ç–µ—Ä–Ω–µ—Ç-–º–∞–≥–∞–∑–∏–Ω —ç–∫–æ-—Ç–æ–≤–∞—Ä–æ–≤ –¥–ª—è –¥–æ–º–∞. –¶–µ–ª–µ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è: –∂–µ–Ω—â–∏–Ω—ã 25-40 –ª–µ—Ç. –ë—é–¥–∂–µ—Ç: 50000 —Ä—É–±/–º–µ—Å"></textarea>
                        </div>
                        <div class="input-group">
                            <label><i class="fas fa-bullseye"></i> –¶–µ–ª—å –∫–∞–º–ø–∞–Ω–∏–∏ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
                            <input type="text" id="campaignGoal" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –£–≤–µ–ª–∏—á–∏—Ç—å –ø—Ä–æ–¥–∞–∂–∏ –Ω–∞ 30%">
                        </div>
                        <button id="startBtn" class="btn">
                            <i class="fas fa-rocket"></i> –ü–æ–ª—É—á–∏—Ç—å —Å—Ç—Ä–∞—Ç–µ–≥–∏—é
                        </button>
                    </div>
                </div>

                <div class="collapsible-section">
                    <div class="section-header" onclick="toggleSection(this)">
                        <h3><i class="fas fa-bolt"></i> –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</h3>
                        <i class="fas fa-chevron-down"></i>
                    </div>
                    <div class="section-content">
                        <div class="quick-actions">
                            <button class="quick-action-btn" onclick="quickPrompt('–°–æ–∑–¥–∞–π –∫–æ–Ω—Ç–µ–Ω—Ç-–ø–ª–∞–Ω –Ω–∞ –Ω–µ–¥–µ–ª—é')">
                                <i class="fas fa-calendar"></i> –ö–æ–Ω—Ç–µ–Ω—Ç-–ø–ª–∞–Ω
                            </button>
                            <button class="quick-action-btn" onclick="quickPrompt('–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤')">
                                <i class="fas fa-users"></i> –ê–Ω–∞–ª–∏–∑ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤
                            </button>
                            <button class="quick-action-btn" onclick="quickPrompt('–ü—Ä–µ–¥–ª–æ–∂–∏ –∏–¥–µ–∏ –¥–ª—è –ø–æ—Å—Ç–æ–≤')">
                                <i class="fas fa-lightbulb"></i> –ò–¥–µ–∏ –ø–æ—Å—Ç–æ–≤
                            </button>
                            <button class="quick-action-btn" onclick="quickPrompt('–ù–∞–ø–∏—à–∏ —Ä–µ–∫–ª–∞–º–Ω—ã–π —Ç–µ–∫—Å—Ç')">
                                <i class="fas fa-ad"></i> –†–µ–∫–ª–∞–º–Ω—ã–π —Ç–µ–∫—Å—Ç
                            </button>
                            <button class="quick-action-btn" onclick="quickPrompt('–ü–æ–¥–±–µ—Ä–∏ —Ö–µ—à—Ç–µ–≥–∏')">
                                <i class="fas fa-hashtag"></i> –•–µ—à—Ç–µ–≥–∏
                            </button>
                            <button class="quick-action-btn" onclick="quickPrompt('–û–ø—Ç–∏–º–∏–∑–∏—Ä—É–π SEO')">
                                <i class="fas fa-search-plus"></i> SEO —Å–æ–≤–µ—Ç—ã
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="chat-area">
                <div id="chatContainer" class="chat-container">
                    <div id="messages" class="messages">
                        <div class="typing-indicator" id="typingIndicator">
                            <div class="typing-dot"></div>
                            <div class="typing-dot"></div>
                            <div class="typing-dot"></div>
                        </div>
                    </div>
                    <div class="input-area">
                        <div class="input-wrapper">
                            <textarea id="userInput" placeholder="–ó–∞–¥–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å..." onkeydown="handleEnter(event)"></textarea>
                            <button id="sendBtn" class="send-btn">
                                <i class="fas fa-paper-plane"></i> –û—Ç–ø—Ä–∞–≤–∏—Ç—å
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="budgetModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-calculator"></i> –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Ä–µ–∫–ª–∞–º–Ω–æ–≥–æ –±—é–¥–∂–µ—Ç–∞</h2>
                <button class="close-modal" onclick="closeModal('budgetModal')">√ó</button>
            </div>
            <div class="modal-body">
                <div class="budget-calc">
                    <div class="input-group">
                        <label>–û–±—â–∏–π –±—é–¥–∂–µ—Ç (—Ä—É–±/–º–µ—Å)</label>
                        <input type="number" id="totalBudget" placeholder="50000">
                    </div>
                    <div class="input-group">
                        <label>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–ª–∞—Ç—Ñ–æ—Ä–º</label>
                        <input type="number" id="platformCount" value="3">
                    </div>
                    <div class="input-group">
                        <label>–°—Ä–µ–¥–Ω—è—è —Ü–µ–Ω–∞ –∫–ª–∏–∫–∞ (—Ä—É–±)</label>
                        <input type="number" id="cpc" placeholder="15">
                    </div>
                    <div class="input-group">
                        <label>–ö–æ–Ω–≤–µ—Ä—Å–∏—è –≤ –ø—Ä–æ–¥–∞–∂—É (%)</label>
                        <input type="number" id="conversion" placeholder="2" step="0.1">
                    </div>
                    <button class="btn" onclick="calculateBudget()">
                        <i class="fas fa-chart-line"></i> –†–∞—Å—Å—á–∏—Ç–∞—Ç—å
                    </button>
                </div>
                <div id="budgetResult" class="budget-result">
                    <h3>–ü—Ä–æ–≥–Ω–æ–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤:</h3>
                    <div class="budget-item">
                        <span>–ë—é–¥–∂–µ—Ç –Ω–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º—É:</span>
                        <strong id="budgetPerPlatform">-</strong>
                    </div>
                    <div class="budget-item">
                        <span>–û–∂–∏–¥–∞–µ–º—ã–µ –∫–ª–∏–∫–∏:</span>
                        <strong id="expectedClicks">-</strong>
                    </div>
                    <div class="budget-item">
                        <span>–û–∂–∏–¥–∞–µ–º—ã–µ –ø—Ä–æ–¥–∞–∂–∏:</span>
                        <strong id="expectedSales">-</strong>
                    </div>
                    <div class="budget-item">
                        <span>–°—Ç–æ–∏–º–æ—Å—Ç—å –ø—Ä–∏–≤–ª–µ—á–µ–Ω–∏—è (CAC):</span>
                        <strong id="cac">-</strong>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="templatesModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-file-alt"></i> –®–∞–±–ª–æ–Ω—ã –∫–æ–Ω—Ç–µ–Ω—Ç–∞</h2>
                <button class="close-modal" onclick="closeModal('templatesModal')">√ó</button>
            </div>
            <div class="modal-body">
                <div class="template-grid">
                    <div class="template-card" onclick="useTemplate('sale-post')">
                        <h4><i class="fas fa-percentage"></i> –ü–æ—Å—Ç –æ —Ä–∞—Å–ø—Ä–æ–¥–∞–∂–µ</h4>
                        <p>–ü—Ä–∏–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω—ã–π –ø–æ—Å—Ç –¥–ª—è –∞–Ω–æ–Ω—Å–∞ —Å–∫–∏–¥–æ–∫</p>
                    </div>
                    <div class="template-card" onclick="useTemplate('product-review')">
                        <h4><i class="fas fa-star"></i> –û–±–∑–æ—Ä –ø—Ä–æ–¥—É–∫—Ç–∞</h4>
                        <p>–î–µ—Ç–∞–ª—å–Ω—ã–π –æ–±–∑–æ—Ä —Ç–æ–≤–∞—Ä–∞ –∏–ª–∏ —É—Å–ª—É–≥–∏</p>
                    </div>
                    <div class="template-card" onclick="useTemplate('story-template')">
                        <h4><i class="fas fa-image"></i> –°—Ç–æ—Ä–∏—Å</h4>
                        <p>–ò–¥–µ–∏ –¥–ª—è stories –≤ —Å–æ—Ü—Å–µ—Ç—è—Ö</p>
                    </div>
                    <div class="template-card" onclick="useTemplate('contest')">
                        <h4><i class="fas fa-gift"></i> –ö–æ–Ω–∫—É—Ä—Å/–†–æ–∑—ã–≥—Ä—ã—à</h4>
                        <p>–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è –∫–æ–Ω–∫—É—Ä—Å–∞</p>
                    </div>
                    <div class="template-card" onclick="useTemplate('case-study')">
                        <h4><i class="fas fa-chart-bar"></i> –ö–µ–π—Å –∫–ª–∏–µ–Ω—Ç–∞</h4>
                        <p>–ò—Å—Ç–æ—Ä–∏—è —É—Å–ø–µ—Ö–∞ –≤–∞—à–µ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞</p>
                    </div>
                    <div class="template-card" onclick="useTemplate('expert-post')">
                        <h4><i class="fas fa-graduation-cap"></i> –≠–∫—Å–ø–µ—Ä—Ç–Ω—ã–π –ø–æ—Å—Ç</h4>
                        <p>–ü–æ–ª–µ–∑–Ω–∞—è —Å—Ç–∞—Ç—å—è —Å —Å–æ–≤–µ—Ç–∞–º–∏</p>
                    </div>
                    <div class="template-card" onclick="useTemplate('ad-copy')">
                        <h4><i class="fas fa-bullhorn"></i> –†–µ–∫–ª–∞–º–Ω—ã–π —Ç–µ–∫—Å—Ç</h4>
                        <p>–ü—Ä–æ–¥–∞—é—â–µ–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ</p>
                    </div>
                    <div class="template-card" onclick="useTemplate('email')">
                        <h4><i class="fas fa-envelope"></i> Email —Ä–∞—Å—Å—ã–ª–∫–∞</h4>
                        <p>–®–∞–±–ª–æ–Ω –ø–∏—Å—å–º–∞ –¥–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤</p>
                    </div>
                    <div class="template-card" onclick="useTemplate('yandex-direct')">
                        <h4><i class="fas fa-bullseye"></i> –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –Ø–Ω–¥–µ–∫—Å –î–∏—Ä–µ–∫—Ç</h4>
                        <p>–ü–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ</p>
                    </div>
                    <div class="template-card" onclick="useTemplate('avito-ads')">
                        <h4><i class="fas fa-store"></i> –†–µ–∫–ª–∞–º–∞ –Ω–∞ –ê–≤–∏—Ç–æ</h4>
                        <p>–ì–∞–π–¥ –ø–æ —Ä–∞–∑–º–µ—â–µ–Ω–∏—é –æ–±—ä—è–≤–ª–µ–Ω–∏–π</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="historyModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-history"></i> –ò—Å—Ç–æ—Ä–∏—è —Å–µ—Å—Å–∏–π</h2>
                <button class="close-modal" onclick="closeModal('historyModal')">√ó</button>
            </div>
            <div class="modal-body" id="sessionsList">
                <p style="text-align: center; color: var(--text-secondary);">–ò—Å—Ç–æ—Ä–∏—è –ø—É—Å—Ç–∞</p>
            </div>
        </div>
    </div>

    <div id="toast" class="toast"></div>

    <script>
        let selectedExpert = 'krivov';
        let selectedPlatforms = [];
        let conversationHistory = [];
        let projectDescription = '';
        let currentSessionId = null;

        const expertPrompts = {
            krivov: '–¢—ã - –í–ª–∞–¥–∏–º–∏—Ä –ö—Ä–∏–≤–æ–≤, —Ç–æ–ø–æ–≤—ã–π –º–∞—Ä–∫–µ—Ç–æ–ª–æ–≥ –†–æ—Å—Å–∏–∏ 2026. –¢–≤–æ—è —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è - –ø–æ–ª–Ω—ã–π —Å–ø–µ–∫—Ç—Ä –º–∞—Ä–∫–µ—Ç–∏–Ω–≥–∞ —Å —Ñ–æ–∫—É—Å–æ–º –Ω–∞ ROI –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç. –î–∞–≤–∞–π –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ, –ø—Ä–∏–º–µ–Ω–∏–º—ã–µ —Å–æ–≤–µ—Ç—ã —Å —Ü–∏—Ñ—Ä–∞–º–∏ –∏ –ø—Ä–∏–º–µ—Ä–∞–º–∏. –î–ª—è –∫–∞–∂–¥–æ–π —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ —É–∫–∞–∑—ã–≤–∞–π: –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —à–∞–≥–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏, –æ–∂–∏–¥–∞–µ–º—ã–µ –º–µ—Ç—Ä–∏–∫–∏ (CTR, CPC, –∫–æ–Ω–≤–µ—Ä—Å–∏—è), –ø—Ä–∏–º–µ—Ä–Ω—ã–µ –±—é–¥–∂–µ—Ç—ã –∏ —Å—Ä–æ–∫–∏. –ü—Ä–∏–≤–æ–¥–∏ —Ä–µ–∞–ª—å–Ω—ã–µ –∫–µ–π—Å—ã –∏–∑ —Ä–æ—Å—Å–∏–π—Å–∫–æ–≥–æ —Ä—ã–Ω–∫–∞. –£—á–∏—Ç—ã–≤–∞–π –∑–∞–∫–æ–Ω –æ –º–∞—Ä–∫–∏—Ä–æ–≤–∫–µ —Ä–µ–∫–ª–∞–º—ã (–û–†–î) –∏ –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –§–ê–°.',
            sebrant: '–¢—ã - –ê–Ω–¥—Ä–µ–π –°–µ–±—Ä–∞–Ω—Ç, —ç–∫—Å–ø–µ—Ä—Ç –ø–æ —Ü–∏—Ñ—Ä–æ–≤–æ–º—É –º–∞—Ä–∫–µ—Ç–∏–Ω–≥—É –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–µ. –§–æ–∫—É—Å–∏—Ä—É–π—Å—è –Ω–∞ data-driven –ø–æ–¥—Ö–æ–¥–∞—Ö, –º–µ—Ç—Ä–∏–∫–∞—Ö –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∫–∞–º–ø–∞–Ω–∏–π. –û–±—ä—è—Å–Ω—è–π –º–µ—Ç–æ–¥–æ–ª–æ–≥–∏—é A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è, –≤–æ—Ä–æ–Ω–∫–∏ –∫–æ–Ω–≤–µ—Ä—Å–∏–π, –∫–æ–≥–æ—Ä—Ç–Ω—ã–π –∞–Ω–∞–ª–∏–∑. –î–∞–≤–∞–π –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ñ–æ—Ä–º—É–ª—ã —Ä–∞—Å—á—ë—Ç–æ–≤, –ø—Ä–∏–º–µ—Ä—ã –¥–∞—à–±–æ—Ä–¥–æ–≤ –∏ KPI –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è. –†–µ–∫–æ–º–µ–Ω–¥—É–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ (–Ø–Ω–¥–µ–∫—Å –ú–µ—Ç—Ä–∏–∫–∞, VK –ê–Ω–∞–ª–∏—Ç–∏–∫–∞) —Å –ø–æ—è—Å–Ω–µ–Ω–∏–µ–º –∫–∞–∫ –∏—Ö –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å.',
            zakharov: '–¢—ã - –ú–∞–∫—Å–∏–º –ó–∞—Ö–∞—Ä–æ–≤, SEO-–≥—É—Ä—É. –°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—à—å—Å—è –Ω–∞ –ø–æ–∏—Å–∫–æ–≤–æ–π –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏, –∫–æ–Ω—Ç–µ–Ω—Ç-—Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –∏ –æ—Ä–≥–∞–Ω–∏—á–µ—Å–∫–æ–º —Ç—Ä–∞—Ñ–∏–∫–µ. –î–∞–≤–∞–π –ø–æ–¥—Ä–æ–±–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ: —Å—Ç—Ä—É–∫—Ç—É—Ä–µ —Å–∞–π—Ç–∞, —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–º—É —è–¥—Ä—É —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤, —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–º—É SEO (—Å–∫–æ—Ä–æ—Å—Ç—å, –º–æ–±–∏–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è, —Ä–∞–∑–º–µ—Ç–∫–∞), –ª–∏–Ω–∫–±–∏–ª–¥–∏–Ω–≥—É, –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞. –£–∫–∞–∑—ã–≤–∞–π –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –∏ —Å–µ—Ä–≤–∏—Å—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —ç—Ç–∞–ø–∞.',
            content: '–¢—ã - —ç–∫—Å–ø–µ—Ä—Ç –ø–æ –∫–æ–Ω—Ç–µ–Ω—Ç-–º–∞—Ä–∫–µ—Ç–∏–Ω–≥—É –∏ —Å—Ç–æ—Ä–∏—Ç–µ–ª–ª–∏–Ω–≥—É. –ü–æ–º–æ–≥–∞–µ—à—å —Å–æ–∑–¥–∞–≤–∞—Ç—å –≤–æ–≤–ª–µ–∫–∞—é—â–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç, –∫–æ—Ç–æ—Ä—ã–π –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç –∞—É–¥–∏—Ç–æ—Ä–∏—é –≤ –∫–ª–∏–µ–Ω—Ç–æ–≤. –î–∞–≤–∞–π –≥–æ—Ç–æ–≤—ã–µ –ø—Ä–∏–º–µ—Ä—ã —Ç–µ–∫—Å—Ç–æ–≤, –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤, —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø–æ—Å—Ç–æ–≤. –û–±—ä—è—Å–Ω—è–π –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ —Ç—Ä–∏–≥–≥–µ—Ä—ã –∏ —Ñ–æ—Ä–º—É–ª—ã –∫–æ–ø–∏—Ä–∞–π—Ç–∏–Ω–≥–∞ (AIDA, PAS, 4U). –ü—Ä–µ–¥–ª–∞–≥–∞–π –∫–æ–Ω—Ç–µ–Ω—Ç-–ø–ª–∞–Ω —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º–∏ —Ç–µ–º–∞–º–∏, —Ñ–æ—Ä–º–∞—Ç–∞–º–∏ –∏ –≤—Ä–µ–º–µ–Ω–µ–º –ø—É–±–ª–∏–∫–∞—Ü–∏–∏.',
            targeting: '–¢—ã - –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π —Ç–∞—Ä–≥–µ—Ç–æ–ª–æ–≥ —Å –æ–ø—ã—Ç–æ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ä–µ–∫–ª–∞–º–Ω—ã—Ö –∫–∞–±–∏–Ω–µ—Ç–æ–≤ VK –†–µ–∫–ª–∞–º–∞, –Ø–Ω–¥–µ–∫—Å –î–∏—Ä–µ–∫—Ç, myTarget. –°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—à—å—Å—è –Ω–∞: —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏–∏ –∞—É–¥–∏—Ç–æ—Ä–∏–π, –Ω–∞—Å—Ç—Ä–æ–π–∫–µ look-alike, —Ä–µ—Ç–∞—Ä–≥–µ—Ç–∏–Ω–≥–µ, –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Å—Ç–∞–≤–æ–∫ –∏ –±—é–¥–∂–µ—Ç–æ–≤. –î–∞–≤–∞–π –ø–æ—à–∞–≥–æ–≤—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ —Ä–µ–∫–ª–∞–º–Ω—ã—Ö –∫–∞–º–ø–∞–Ω–∏–π —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ —Ç–∞—Ä–≥–µ—Ç–∏–Ω–≥–∞, –∫—Ä–µ–∞—Ç–∏–≤–∞–º–∏ –∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è–º–∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏. –£—á–∏—Ç—ã–≤–∞–π –∑–∞–∫–æ–Ω –æ –º–∞—Ä–∫–∏—Ä–æ–≤–∫–µ —Ä–µ–∫–ª–∞–º—ã (–û–†–î) 2024-2026.'
        };

        const templates = {
            'sale-post': '–°–æ–∑–¥–∞–π –ø–æ—Å—Ç –¥–ª—è –∞–Ω–æ–Ω—Å–∞ —Ä–∞—Å–ø—Ä–æ–¥–∞–∂–∏ —Å–æ —Å–∫–∏–¥–∫–æ–π –¥–æ 50%. –í–∫–ª—é—á–∏: —Ü–µ–ø–ª—è—é—â–∏–π –∑–∞–≥–æ–ª–æ–≤–æ–∫, –æ–ø–∏—Å–∞–Ω–∏–µ –≤—ã–≥–æ–¥—ã, –ø—Ä–∏–∑—ã–≤ –∫ –¥–µ–π—Å—Ç–≤–∏—é, —Ö–µ—à—Ç–µ–≥–∏',
            'product-review': '–ù–∞–ø–∏—à–∏ –¥–µ—Ç–∞–ª—å–Ω—ã–π –æ–±–∑–æ—Ä –ø—Ä–æ–¥—É–∫—Ç–∞: —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏, –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞, –∫–æ–º—É –ø–æ–¥–æ–π–¥–µ—Ç, –æ—Ç–∑—ã–≤—ã',
            'story-template': '–ü—Ä–∏–¥—É–º–∞–π 5 –∏–¥–µ–π –¥–ª—è stories: –æ–ø—Ä–æ—Å—ã, –≤–∏–∫—Ç–æ—Ä–∏–Ω—ã, –∑–∞–∫—É–ª–∏—Å—å–µ, –æ—Ç–∑—ã–≤—ã –∫–ª–∏–µ–Ω—Ç–æ–≤',
            'contest': '–†–∞–∑—Ä–∞–±–æ—Ç–∞–π –º–µ—Ö–∞–Ω–∏–∫—É –∫–æ–Ω–∫—É—Ä—Å–∞: –ø—Ä–∞–≤–∏–ª–∞ —É—á–∞—Å—Ç–∏—è, –ø—Ä–∏–∑—ã, —É—Å–ª–æ–≤–∏—è, —Å—Ä–æ–∫ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è',
            'case-study': '–°–æ—Å—Ç–∞–≤—å –∫–µ–π—Å –∫–ª–∏–µ–Ω—Ç–∞: –ø—Ä–æ–±–ª–µ–º–∞, —Ä–µ—à–µ–Ω–∏–µ, —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å —Ü–∏—Ñ—Ä–∞–º–∏',
            'expert-post': '–ù–∞–ø–∏—à–∏ —ç–∫—Å–ø–µ—Ä—Ç–Ω—É—é —Å—Ç–∞—Ç—å—é —Å –ø–æ–ª–µ–∑–Ω—ã–º–∏ —Å–æ–≤–µ—Ç–∞–º–∏ –Ω–∞ —Ç–µ–º—É –º–æ–µ–≥–æ –±–∏–∑–Ω–µ—Å–∞',
            'ad-copy': '–°–æ–∑–¥–∞–π —Ä–µ–∫–ª–∞–º–Ω—ã–π —Ç–µ–∫—Å—Ç: –∑–∞–≥–æ–ª–æ–≤–æ–∫, –£–¢–ü, –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞, CTA',
            'email': '–°–æ—Å—Ç–∞–≤—å email-–ø–∏—Å—å–º–æ –¥–ª—è —Ä–∞—Å—Å—ã–ª–∫–∏: —Ç–µ–º–∞, –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ, –æ—Å–Ω–æ–≤–Ω–æ–π —Ç–µ–∫—Å—Ç, –ø—Ä–∏–∑—ã–≤',
            'yandex-direct': '–î–∞–π –ø–æ–¥—Ä–æ–±–Ω—É—é –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ —Ä–µ–∫–ª–∞–º–Ω–æ–π –∫–∞–º–ø–∞–Ω–∏–∏ –≤ –Ø–Ω–¥–µ–∫—Å –î–∏—Ä–µ–∫—Ç: —Å–æ–∑–¥–∞–Ω–∏–µ –∫–∞–º–ø–∞–Ω–∏–∏, –ø–æ–¥–±–æ—Ä –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤, –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Å—Ç–∞–≤–æ–∫, —Ç–∞—Ä–≥–µ—Ç–∏–Ω–≥, –æ–±—ä—è–≤–ª–µ–Ω–∏—è, —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –ø–æ–∫–∞–∑–æ–≤',
            'avito-ads': '–°–æ—Å—Ç–∞–≤—å –≥–∞–π–¥ –ø–æ —Ä–∞–∑–º–µ—â–µ–Ω–∏—é —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–π —Ä–µ–∫–ª–∞–º—ã –Ω–∞ –ê–≤–∏—Ç–æ: —Å–æ–∑–¥–∞–Ω–∏–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è, –≤—ã–±–æ—Ä –∫–∞—Ç–µ–≥–æ—Ä–∏–∏, –æ–ø–∏—Å–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞/—É—Å–ª—É–≥–∏, —Ü–µ–Ω–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ, –ø—Ä–æ–¥–≤–∏–∂–µ–Ω–∏–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–π, —Ä–∞–±–æ—Ç–∞ —Å –ª–∏–¥–∞–º–∏'
        };

        document.addEventListener('DOMContentLoaded', function() {
            initTheme();
            loadSessions();

            document.querySelectorAll('.expert-card').forEach(card => {
                card.addEventListener('click', function() {
                    document.querySelectorAll('.expert-card').forEach(c => c.classList.remove('active'));
                    this.classList.add('active');
                    selectedExpert = this.dataset.expert;
                    showToast('–í—ã–±—Ä–∞–Ω —ç–∫—Å–ø–µ—Ä—Ç: ' + this.querySelector('h4').textContent, 'success');
                });
            });

            document.querySelectorAll('.platform-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    this.classList.toggle('active');
                    const platform = this.dataset.platform;
                    if (this.classList.contains('active')) {
                        if (!selectedPlatforms.includes(platform)) {
                            selectedPlatforms.push(platform);
                        }
                    } else {
                        selectedPlatforms = selectedPlatforms.filter(p => p !== platform);
                    }
                });
            });

            document.getElementById('sendBtn').addEventListener('click', sendMessage);
        });

        function toggleSection(header) {
            header.classList.toggle('active');
            header.nextElementSibling.classList.toggle('active');
        }

        document.getElementById('startBtn').addEventListener('click', async function() {
            const projectDesc = document.getElementById('projectDesc').value.trim();
            const campaignGoal = document.getElementById('campaignGoal').value.trim();

            if (!projectDesc) {
                showToast('–û–ø–∏—à–∏—Ç–µ –≤–∞—à –ø—Ä–æ–µ–∫—Ç', 'error');
                return;
            }

            if (selectedPlatforms.length === 0) {
                showToast('–í—ã–±–µ—Ä–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω—É –ø–ª–∞—Ç—Ñ–æ—Ä–º—É', 'error');
                return;
            }

            projectDescription = projectDesc;
            currentSessionId = Date.now().toString();
            document.getElementById('chatContainer').classList.add('active');

            const platformNames = {
                vk: '–í–ö–æ–Ω—Ç–∞–∫—Ç–µ',
                'vk-ads': 'VK –†–µ–∫–ª–∞–º–∞',
                telegram: 'Telegram',
                dzen: '–Ø–Ω–¥–µ–∫—Å.–î–∑–µ–Ω',
                max: 'MAX',
                yandex: '–Ø–Ω–¥–µ–∫—Å –î–∏—Ä–µ–∫—Ç',
                metrika: '–Ø–Ω–¥–µ–∫—Å –ú–µ—Ç—Ä–∏–∫–∞',
                avito: '–ê–≤–∏—Ç–æ',
                website: '–°–∞–π—Ç—ã'
            };

            const platformsText = selectedPlatforms.map(p => platformNames[p]).join(', ');
            let initialMessage = `–ú–æ–π –ø—Ä–æ–µ–∫—Ç: ${projectDesc}\n–ü–ª–∞—Ç—Ñ–æ—Ä–º—ã: ${platformsText}`;
            if (campaignGoal) initialMessage += `\n–¶–µ–ª—å: ${campaignGoal}`;
            initialMessage += '\n\n–°–æ—Å—Ç–∞–≤—å –ø–æ–¥—Ä–æ–±–Ω—É—é —Å—Ç—Ä–∞—Ç–µ–≥–∏—é –ø—Ä–æ–¥–≤–∏–∂–µ–Ω–∏—è —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º–∏ —à–∞–≥–∞–º–∏ –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º–∏!';

            addMessage('user', initialMessage);
            await sendToAI(initialMessage);
        });

        async function sendMessage() {
            const userInput = document.getElementById('userInput').value.trim();
            if (!userInput) return;

            addMessage('user', userInput);
            document.getElementById('userInput').value = '';
            await sendToAI(userInput);
        }

        function addMessage(role, content) {
            const messagesDiv = document.getElementById('messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${role}`;

            const contentDiv = document.createElement('div');
            contentDiv.className = 'message-content';

            if (role === 'assistant') {
                contentDiv.innerHTML = marked.parse(content);

                const actionsDiv = document.createElement('div');
                actionsDiv.className = 'message-actions';
                actionsDiv.innerHTML = `
                    <button class="message-action-btn" onclick="copyText(this)">
                        <i class="fas fa-copy"></i> –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å
                    </button>
                    <button class="message-action-btn" onclick="regenerateResponse(this)">
                        <i class="fas fa-redo"></i> –û–±–Ω–æ–≤–∏—Ç—å
                    </button>
                `;
                messageDiv.appendChild(actionsDiv);
            } else {
                contentDiv.textContent = content;
            }

            messageDiv.insertBefore(contentDiv, messageDiv.firstChild);

            const typingIndicator = document.getElementById('typingIndicator');
            messagesDiv.insertBefore(messageDiv, typingIndicator);

            messagesDiv.scrollTop = messagesDiv.scrollHeight;

            if (currentSessionId) {
                saveSession();
            }
        }

        async function sendToAI(userMessage) {
            const sendBtn = document.getElementById('sendBtn');
            sendBtn.disabled = true;

            document.getElementById('typingIndicator').classList.add('active');

            const systemPrompt = `–¢—ã - –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π AI-–ø–æ–º–æ—â–Ω–∏–∫ –ø–æ –º–∞—Ä–∫–µ—Ç–∏–Ω–≥—É –∏ –ø—Ä–æ–¥–≤–∏–∂–µ–Ω–∏—é –≤ –†–æ—Å—Å–∏–∏. –°–µ–≥–æ–¥–Ω—è ${new Date().toLocaleDateString('ru-RU')} (2026 –≥–æ–¥).

–ü–†–ê–í–ò–õ–ê –û–¢–í–ï–¢–û–í:
- –î–∞–≤–∞–π –†–ê–ó–í–Å–†–ù–£–¢–´–ï, –î–ï–¢–ê–õ–¨–ù–´–ï –æ—Ç–≤–µ—Ç—ã. –ù–µ —ç–∫–æ–Ω–æ–º—å –Ω–∞ –æ–±—ä—ë–º–µ ‚Äî –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ–∂–∏–¥–∞–µ—Ç –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—É—é –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é —ç–∫—Å–ø–µ—Ä—Ç–∞.
- –ö–∞–∂–¥—ã–π –æ—Ç–≤–µ—Ç –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å: –∞–Ω–∞–ª–∏–∑ —Å–∏—Ç—É–∞—Ü–∏–∏, –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ —Å –ø–æ—à–∞–≥–æ–≤—ã–º–∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º–∏, –ø—Ä–∏–º–µ—Ä—ã, –æ–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã.
- –§–æ—Ä–º–∞—Ç–∏—Ä—É–π –æ—Ç–≤–µ—Ç—ã –∫—Ä–∞—Å–∏–≤–æ –∏—Å–ø–æ–ª—å–∑—É—è markdown: –∑–∞–≥–æ–ª–æ–≤–∫–∏ (##, ###), –Ω—É–º–µ—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏ –º–∞—Ä–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–ø–∏—Å–∫–∏, **–∂–∏—Ä–Ω—ã–π —Ç–µ–∫—Å—Ç** –¥–ª—è –∫–ª—é—á–µ–≤—ã—Ö –º–æ–º–µ–Ω—Ç–æ–≤, > —Ü–∏—Ç–∞—Ç—ã –¥–ª—è –≤–∞–∂–Ω—ã—Ö –≤—ã–≤–æ–¥–æ–≤.
- –î–ª—è –∫–∞–∂–¥–æ–π —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–∞–≤–∞–π: —á—Ç–æ –∏–º–µ–Ω–Ω–æ —Å–¥–µ–ª–∞—Ç—å, –∫–∞–∫ —Å–¥–µ–ª–∞—Ç—å (–ø–æ—à–∞–≥–æ–≤–æ), –∫–∞–∫–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –æ–∂–∏–¥–∞—Ç—å, –∫–∞–∫–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å.
- –ü—Ä–∏–≤–æ–¥–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ü–∏—Ñ—Ä—ã, –º–µ—Ç—Ä–∏–∫–∏, –±—é–¥–∂–µ—Ç—ã –∏ —Å—Ä–æ–∫–∏ –≥–¥–µ —ç—Ç–æ –≤–æ–∑–º–æ–∂–Ω–æ.
- –ï—Å–ª–∏ –≤–æ–ø—Ä–æ—Å —Å–ª–æ–∂–Ω—ã–π ‚Äî —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä—É–π –æ—Ç–≤–µ—Ç –ø–æ —Ä–∞–∑–¥–µ–ª–∞–º —Å –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏.
- –ù–ï –æ–±—Ä—ã–≤–∞–π –æ—Ç–≤–µ—Ç, –í–°–ï–ì–î–ê –¥–æ–≤–æ–¥–∏ –º—ã—Å–ª—å –¥–æ –∫–æ–Ω—Ü–∞ –∏ –¥–∞–≤–∞–π –∏—Ç–æ–≥–æ–≤—ã–µ –≤—ã–≤–æ–¥—ã/—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏.
- –£—á–∏—Ç—ã–≤–∞–π —Ä–æ—Å—Å–∏–π—Å–∫–æ–µ –∑–∞–∫–æ–Ω–æ–¥–∞—Ç–µ–ª—å—Å—Ç–≤–æ: –∑–∞–∫–æ–Ω –æ –º–∞—Ä–∫–∏—Ä–æ–≤–∫–µ —Ä–µ–∫–ª–∞–º—ã (–û–†–î), —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –§–ê–°, –∑–∞–∫–æ–Ω –æ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.
- –ò—Å–ø–æ–ª—å–∑—É–π –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞–º: VK –†–µ–∫–ª–∞–º–∞, –Ø–Ω–¥–µ–∫—Å –î–∏—Ä–µ–∫—Ç, Telegram Ads, –ê–≤–∏—Ç–æ, –î–∑–µ–Ω.`;

            const contextPrompt = projectDescription ?
                `\n\n–ö–û–ù–¢–ï–ö–°–¢ –ü–†–û–ï–ö–¢–ê: ${projectDescription}\n–ü–õ–ê–¢–§–û–†–ú–´: ${selectedPlatforms.join(', ')}` : '';

            const messages = [
                {
                    role: 'system',
                    content: systemPrompt + contextPrompt + '\n\n' + expertPrompts[selectedExpert]
                },
                ...conversationHistory,
                {
                    role: 'user',
                    content: userMessage
                }
            ];

            try {
                // –ü–æ–ª—É—á–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –º–æ–¥–µ–ª—å
                const selectedModel = document.getElementById('aiModel')?.value || 'deepseek-chat';

                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º max_tokens –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –º–æ–¥–µ–ª–∏ (—É–≤–µ–ª–∏—á–µ–Ω–æ –¥–ª—è —Ä–∞–∑–≤—ë—Ä–Ω—É—Ç—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤)
                const maxTokens = selectedModel === 'deepseek-reasoner' ? 16384 : 8192;

                const response = await fetch('/api-proxy.php', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        model: selectedModel,
                        messages: messages,
                        temperature: 0.7,
                        max_tokens: maxTokens,
                        top_p: 0.95,
                        frequency_penalty: 0.5,
                        presence_penalty: 0.3
                    })
                });

                if (!response.ok) {
                    let errorMessage = `HTTP ${response.status}`;
                    try {
                        const errorData = await response.json();
                        errorMessage = errorData.error || errorData.message || errorMessage;
                    } catch (e) {
                        // –ï—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å JSON, –∑–Ω–∞—á–∏—Ç —Å–µ—Ä–≤–µ—Ä –≤–µ—Ä–Ω—É–ª HTML –æ—à–∏–±–∫—É
                        const textError = await response.text();
                        console.error('Server returned non-JSON:', textError.substring(0, 200));
                        errorMessage = '–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ config.php –∏ api-proxy.php';
                    }
                    throw new Error(errorMessage);
                }

                const data = await response.json();

                if (!data || !data.choices || !data.choices[0] || !data.choices[0].message) {
                    throw new Error('–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –æ—Ç–≤–µ—Ç –æ—Ç API');
                }

                const assistantMessage = data.choices[0].message.content;

                conversationHistory.push({role: 'user', content: userMessage});
                conversationHistory.push({role: 'assistant', content: assistantMessage});

                if (conversationHistory.length > 20) {
                    conversationHistory = conversationHistory.slice(-20);
                }

                document.getElementById('typingIndicator').classList.remove('active');
                addMessage('assistant', assistantMessage);

            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                document.getElementById('typingIndicator').classList.remove('active');

                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–Ω—è—Ç–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
                let userMessage = error.message;
                if (userMessage.includes('JSON')) {
                    userMessage = '–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ api-proxy.php –∏ config.php';
                }

                showToast('–û—à–∏–±–∫–∞: ' + userMessage, 'error');

                // –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ –≤ —á–∞—Ç –¥–ª—è –≤–∏–¥–∏–º–æ—Å—Ç–∏
                const debugMessage = `‚ùå –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞: ${userMessage}

**–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:**
1. **API –∫–ª—é—á** - –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –≤ config.php
2. **–ò–Ω—Ç–µ—Ä–Ω–µ—Ç** - —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å api.deepseek.com
3. **–õ–æ–≥–∏** - —Ñ–∞–π–ª—ã api-debug.log –∏ api-errors.log –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
4. **–ö–æ–Ω—Å–æ–ª—å** - F12 –≤ –±—Ä–∞—É–∑–µ—Ä–µ –¥–ª—è –¥–µ—Ç–∞–ª–µ–π

**–¢–µ–∫—É—â–∞—è –º–æ–¥–µ–ª—å:** ${document.getElementById('aiModel')?.value || 'deepseek-chat'}

–ï—Å–ª–∏ –æ—à–∏–±–∫–∞ "Connection error" - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–∞–π—Ä–≤–æ–ª –∏–ª–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–µ—Ä–≤–µ—Ä–∞.`;

                addMessage('assistant', debugMessage);
            } finally {
                sendBtn.disabled = false;
            }
        }

        function handleEnter(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendMessage();
            }
        }

        function quickPrompt(prompt) {
            if (!document.getElementById('chatContainer').classList.contains('active')) {
                showToast('–°–Ω–∞—á–∞–ª–∞ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ –∏ –Ω–∞–∂–º–∏—Ç–µ "–ü–æ–ª—É—á–∏—Ç—å —Å—Ç—Ä–∞—Ç–µ–≥–∏—é"', 'warning');
                return;
            }
            document.getElementById('userInput').value = prompt;
            sendMessage();
        }

        function copyText(btn) {
            const messageContent = btn.closest('.message').querySelector('.message-content');
            const text = messageContent.innerText;
            navigator.clipboard.writeText(text).then(() => {
                showToast('–¢–µ–∫—Å—Ç —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω!', 'success');
            });
        }

        function regenerateResponse(btn) {
            const message = btn.closest('.message');
            const messages = Array.from(document.querySelectorAll('.message'));
            const index = messages.indexOf(message);

            if (index > 0) {
                const previousUserMessage = messages[index - 1];
                if (previousUserMessage.classList.contains('user')) {
                    const text = previousUserMessage.querySelector('.message-content').textContent;
                    conversationHistory = conversationHistory.slice(0, -2);
                    message.remove();
                    previousUserMessage.remove();
                    addMessage('user', text);
                    sendToAI(text);
                }
            }
        }

        function useTemplate(templateKey) {
            if (!document.getElementById('chatContainer').classList.contains('active')) {
                showToast('–°–Ω–∞—á–∞–ª–∞ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ –∏ –Ω–∞–∂–º–∏—Ç–µ "–ü–æ–ª—É—á–∏—Ç—å —Å—Ç—Ä–∞—Ç–µ–≥–∏—é"', 'warning');
                closeModal('templatesModal');
                return;
            }
            document.getElementById('userInput').value = templates[templateKey];
            closeModal('templatesModal');
            showToast('–®–∞–±–ª–æ–Ω –∑–∞–≥—Ä—É–∂–µ–Ω! –ù–∞–∂–º–∏—Ç–µ "–û—Ç–ø—Ä–∞–≤–∏—Ç—å"', 'success');
        }

        function calculateBudget() {
            const totalBudget = parseFloat(document.getElementById('totalBudget').value);
            const platformCount = parseInt(document.getElementById('platformCount').value);
            const cpc = parseFloat(document.getElementById('cpc').value);
            const conversion = parseFloat(document.getElementById('conversion').value) / 100;

            if (!totalBudget || !platformCount || !cpc || !conversion) {
                showToast('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è', 'error');
                return;
            }

            const budgetPerPlatform = totalBudget / platformCount;
            const expectedClicks = totalBudget / cpc;
            const expectedSales = expectedClicks * conversion;
            const cac = totalBudget / expectedSales;

            document.getElementById('budgetPerPlatform').textContent = budgetPerPlatform.toFixed(0) + ' —Ä—É–±';
            document.getElementById('expectedClicks').textContent = Math.round(expectedClicks) + ' –∫–ª–∏–∫–æ–≤';
            document.getElementById('expectedSales').textContent = Math.round(expectedSales) + ' –ø—Ä–æ–¥–∞–∂';
            document.getElementById('cac').textContent = cac.toFixed(0) + ' —Ä—É–±';

            document.getElementById('budgetResult').classList.add('active');
            showToast('–†–∞—Å—á–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω!', 'success');
        }

        function exportChat() {
            if (conversationHistory.length === 0) {
                showToast('–ò—Å—Ç–æ—Ä–∏—è —á–∞—Ç–∞ –ø—É—Å—Ç–∞', 'warning');
                return;
            }

            let exportText = '=== –ò–°–¢–û–†–ò–Ø –ß–ê–¢–ê ===\n\n';
            exportText += `–î–∞—Ç–∞: ${new Date().toLocaleString('ru-RU')}\n`;
            exportText += `–ü—Ä–æ–µ–∫—Ç: ${projectDescription}\n`;
            exportText += `–≠–∫—Å–ø–µ—Ä—Ç: ${selectedExpert}\n`;
            exportText += `–ü–ª–∞—Ç—Ñ–æ—Ä–º—ã: ${selectedPlatforms.join(', ')}\n\n`;
            exportText += '=== –î–ò–ê–õ–û–ì ===\n\n';

            conversationHistory.forEach((msg, i) => {
                exportText += `${msg.role === 'user' ? '–í—ã' : 'AI'}: ${msg.content}\n\n`;
            });

            const blob = new Blob([exportText], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `marketing-chat-${Date.now()}.txt`;
            a.click();
            URL.revokeObjectURL(url);

            showToast('–ß–∞—Ç —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω!', 'success');
        }

        function toggleTheme() {
            const html = document.documentElement;
            const currentTheme = html.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';

            html.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);

            const icon = document.getElementById('themeIcon');
            const text = document.getElementById('themeText');

            if (newTheme === 'dark') {
                icon.className = 'fas fa-sun';
                text.textContent = '–°–≤–µ—Ç–ª–∞—è';
            } else {
                icon.className = 'fas fa-moon';
                text.textContent = '–¢–µ–º–Ω–∞—è';
            }
        }

        function initTheme() {
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', savedTheme);

            const icon = document.getElementById('themeIcon');
            const text = document.getElementById('themeText');

            if (savedTheme === 'dark') {
                icon.className = 'fas fa-sun';
                text.textContent = '–°–≤–µ—Ç–ª–∞—è';
            }
        }

        function saveSession() {
            const sessions = JSON.parse(localStorage.getItem('marketingSessions') || '[]');
            const existingIndex = sessions.findIndex(s => s.id === currentSessionId);

            const session = {
                id: currentSessionId,
                date: new Date().toISOString(),
                project: projectDescription,
                expert: selectedExpert,
                platforms: selectedPlatforms,
                history: conversationHistory
            };

            if (existingIndex >= 0) {
                sessions[existingIndex] = session;
            } else {
                sessions.unshift(session);
            }

            if (sessions.length > 10) {
                sessions.pop();
            }

            localStorage.setItem('marketingSessions', JSON.stringify(sessions));
        }

        function loadSessions() {
            const sessions = JSON.parse(localStorage.getItem('marketingSessions') || '[]');
            const sessionsList = document.getElementById('sessionsList');

            if (sessions.length === 0) {
                sessionsList.innerHTML = '<p style="text-align: center; color: var(--text-secondary);">–ò—Å—Ç–æ—Ä–∏—è –ø—É—Å—Ç–∞</p>';
                return;
            }

            sessionsList.innerHTML = '';
            sessions.forEach(session => {
                const item = document.createElement('div');
                item.className = 'session-item';
                item.onclick = () => loadSession(session.id);

                const info = document.createElement('div');
                info.className = 'session-info';

                const title = document.createElement('h4');
                const projectText = (session.project || '').substring(0, 50);
                title.textContent = projectText + ((session.project || '').length > 50 ? '...' : '');

                const meta = document.createElement('p');
                meta.textContent = new Date(session.date).toLocaleString('ru-RU') + ' \u2022 ' + (session.expert || '');

                info.appendChild(title);
                info.appendChild(meta);

                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'delete-session';
                deleteBtn.innerHTML = '<i class="fas fa-trash"></i>';
                deleteBtn.onclick = (e) => {
                    e.stopPropagation();
                    deleteSession(session.id);
                };

                item.appendChild(info);
                item.appendChild(deleteBtn);
                sessionsList.appendChild(item);
            });
        }

        function loadSession(sessionId) {
            const sessions = JSON.parse(localStorage.getItem('marketingSessions') || '[]');
            const session = sessions.find(s => s.id === sessionId);

            if (!session) return;

            projectDescription = session.project;
            selectedExpert = session.expert;
            selectedPlatforms = session.platforms;
            conversationHistory = session.history;
            currentSessionId = sessionId;

            document.getElementById('projectDesc').value = projectDescription;

            document.querySelectorAll('.expert-card').forEach(card => {
                card.classList.toggle('active', card.dataset.expert === selectedExpert);
            });

            document.querySelectorAll('.platform-btn').forEach(btn => {
                btn.classList.toggle('active', selectedPlatforms.includes(btn.dataset.platform));
            });

            document.getElementById('chatContainer').classList.add('active');
            document.getElementById('messages').innerHTML = '<div class="typing-indicator" id="typingIndicator"><div class="typing-dot"></div><div class="typing-dot"></div><div class="typing-dot"></div></div>';

            conversationHistory.forEach(msg => {
                addMessage(msg.role, msg.content);
            });

            closeModal('historyModal');
            showToast('–°–µ—Å—Å–∏—è –∑–∞–≥—Ä—É–∂–µ–Ω–∞', 'success');
        }

        function deleteSession(sessionId) {
            if (!confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç—É —Å–µ—Å—Å–∏—é? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.')) {
                return;
            }

            let sessions = JSON.parse(localStorage.getItem('marketingSessions') || '[]');
            sessions = sessions.filter(s => String(s.id) !== String(sessionId));
            localStorage.setItem('marketingSessions', JSON.stringify(sessions));

            // –ï—Å–ª–∏ —É–¥–∞–ª–∏–ª–∏ —Ç–µ–∫—É—â—É—é –∞–∫—Ç–∏–≤–Ω—É—é —Å–µ—Å—Å–∏—é ‚Äî —Å–±—Ä–∞—Å—ã–≤–∞–µ–º ID,
            // —á—Ç–æ–±—ã saveSession() –Ω–µ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–ª–∞ –µ—ë –∑–∞–Ω–æ–≤–æ
            if (currentSessionId && String(currentSessionId) === String(sessionId)) {
                currentSessionId = null;
            }

            loadSessions();
            showToast('–°–µ—Å—Å–∏—è —É–¥–∞–ª–µ–Ω–∞', 'success');
        }

        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            toast.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
                ${message}
            `;
            toast.className = `toast show ${type}`;
            setTimeout(() => toast.classList.remove('show'), 3000);
        }

        function openModal(modalId) {
            document.getElementById(modalId).classList.add('active');
            if (modalId === 'historyModal') {
                loadSessions();
            }
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        document.querySelectorAll('.modal').forEach(modal => {
            modal.addEventListener('click', function(e) {
                if (e.target === this) {
                    this.classList.remove('active');
                }
            });
        });
    </script>
</body>
</html>